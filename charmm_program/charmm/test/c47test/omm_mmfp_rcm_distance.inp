* CHARMM c47 testcase:omm_mmfp_rcm_distance.inp 
* Test implementation of MMFP RCM DISTANCE  
* in OpenMM interface
*

if ?openmm .ne. 1 then
   echo "Test NOT performed."
   stop
endif

if ?numnode .ne. 1 then
 echo "Test NOT performed in parallel."
 stop
endif

stream datadir.def

set tol = 6e-4

set name etoh2 

!read in the neccessary parameters
GOTO toppar_sub
label toppar_ret

!build a system with two 
!ethanols placed some distance
!apart
!
read SEQU ETOH 2
generate SEG 
autogenerate angles dihedrals

set return rcor1
GOTO readc
label rcor1

!
! translate a residue in some direction
COOR trans XDIR 3 YDIR 3 ZDIR 3 sele resid 2 end

!
! Nonbonded options
NBONds cutnb 994 ctonnb 990 ctofnb 992 atom vatom cdie switch vswitch 

SKIPe BOND ANGLe UREYb DIHEd ELEC VDW 

!
! MMFP RCM Distance restraints
! tested with various shape-specifications

!
! Shape-specification: SPHEre 
MMFP
GEO SPHere RCM DISTance -
    HARMONIC SYMM FORCe 2. DROFf 1. -
	sele resid 1 end -
	sele resid 2 end
GEO PRINT
END


ENERgy 
set e1 = ?ENER

ENERgy OMM
set eomm1 = ?ENER
OMM OFF

calc diff = abs ( @e1 - @eomm1 )
set status = fail
if @diff lt @tol set status = pass
echo test case: @status Test 1
if @status eq FAIL set overall = @status

!
! Shape-specification - CYLINdrical
MMFP 
GEO RESET
GEO CYLIN RCM DISTance -
    YDIR 1 -
    HARMONIC SYMM FORCe 2. DROFf 1. -
	sele resid 1 end -
	sele resid 2 end
END
ENERgy 
set e1 = ?ENER

ENERgy OMM
set eomm1 = ?ENER
OMM OFF

calc diff = abs ( @e1 - @eomm1 )
set status = fail
if @diff lt @tol set status = pass
echo test case: @status Test 2
if @status eq FAIL set overall = @status

!
! Shape-specification - PLANar
MMFP
GEO RESET
GEO PLANar RCM DISTance -
    ZDIR 1 -
    HARMONIC SYMM FORCe 2. DROFf 1. -
	sele resid 1 end -
	sele resid 2 end
END
ENERgy 
set e1 = ?ENER

ENERgy OMM
set eomm1 = ?ENER
OMM OFF

calc diff = abs ( @e1 - @eomm1 )
set status = fail
if @diff lt @tol set status = pass
echo test case: @status Test 3
if @status eq FAIL set overall = @status

STOP


label toppar_sub

read rtf card
* excerpt from top_all36_cgenff.rtf
*
36 1

MASS     1 H      1.00800 H ! polar H
MASS  -1  HGA2       1.00800 H ! alphatic proton, CH2
MASS  -1  HGA3       1.00800 H ! alphatic proton, CH3
MASS  -1  HGP1       1.00800 H ! polar H
MASS  -1  OG311     15.99940 O ! hydroxyl oxygen
MASS  -1  CG311     12.01100 C ! aliphatic C with 1 H, CH
MASS  -1  CG321     12.01100 C ! aliphatic C for CH2
MASS  -1  CG331     12.01100 C ! aliphatic C for methyl group (-CH3)


DEFA FIRS NONE LAST NONE
AUTO ANGLES DIHE

RESI ETOH          0.00 ! C2H6O, Ethanol, adm jr.
GROUP
GROUP            ! CHARGE   CH_PENALTY
ATOM C1     CG331  -0.270 !    0.000
ATOM C2     CG321   0.050 !    0.000
ATOM O1     OG311  -0.650 !    0.000
ATOM H1     HGA3    0.090 !    0.000
ATOM H2     HGA3    0.090 !    0.000
ATOM H3     HGA3    0.090 !    0.000
ATOM H4     HGA2    0.090 !    0.000
ATOM H5     HGA2    0.090 !    0.000
ATOM H6     HGP1    0.420 !    0.000

BOND C1   C2  
BOND C2   O1  
BOND C1   H1  
BOND C1   H2  
BOND C1   H3  
BOND C2   H4  
BOND C2   H5  
BOND O1   H6  

end

read param card
* excerpt from par_all27_prot_na.prm
*

BONDS
CG321  CG331   222.50     1.5280 ! PROT alkane update, adm jr., 3/2/92
CG321  OG311   428.00     1.4200 ! PROT mMOL     vib fit EMB 11/21/89
CG321  HGA2    309.00     1.1110 ! PROT alkane update, adm jr., 3/2/92
CG331  HGA3    322.00     1.1110 ! PROT alkane update, adm jr., 3/2/92
OG311  HGP1    545.00     0.9600 ! PROT EMB 11/21/89 mMOL     vib fit; og tested on MeOH EtOH,...

ANGLES
CG331  CG321  OG311    75.70    110.10 ! PROT MeOH, EMB, 10/10/89
CG331  CG321  HGA2     34.60    110.10   22.53   2.17900 ! PROT alkane update, adm jr., 3/2/92
OG311  CG321  HGA2     45.90    108.89 ! PROT MeOH, EMB, 10/10/89
HGA2   CG321  HGA2     35.50    109.00    5.40   1.80200 ! PROT alkane update, adm jr., 3/2/92
CG321  CG331  HGA3     34.60    110.10   22.53   2.17900 ! PROT alkane update, adm jr., 3/2/92
HGA3   CG331  HGA3     35.50    108.40    5.40   1.80200 ! PROT alkane update, adm jr., 3/2/92
CG321  OG311  HGP1     50.00    106.00 ! sng mod (qm and crystal data); was 57.5 106

DIHEDRALS
OG311  CG321  CG331  HGA3       0.1600  3     0.00 ! PROT rotation barrier in Ethane (SF)
HGA2   CG321  CG331  HGA3       0.1600  3     0.00 ! PROT rotation barrier in Ethane (SF)
CG331  CG321  OG311  HGP1       1.1300  1     0.00 ! og MOL    
CG331  CG321  OG311  HGP1       0.1400  2     0.00 ! og MOL    
CG331  CG321  OG311  HGP1       0.2400  3     0.00 ! og MOL    
HGA2   CG321  OG311  HGP1       0.1800  3     0.00 ! og mMOL    

IMPROPERS


NONBONDED nbxmod  5 atom cdiel shift vatom vdistance vswitch -
cutnb 14.0 ctofnb 12.0 ctonnb 10.0 eps 1.0 e14fac 1.0 wmin 1.5

HGA1     0.0       -0.0450     1.3400 ! alkane, igor, 6/05
HGA2     0.0       -0.0350     1.3400 ! alkane, igor, 6/05
HGA3     0.0       -0.0240     1.3400 ! alkane, yin and mackerell, 4/98
HGP1     0.0       -0.0460     0.2245 ! polar H
CG321    0.0       -0.0560     2.0100   0.0 -0.01 1.9 ! alkane (CT2), 4/98, yin, adm jr, also used by viv
CG331    0.0       -0.0780     2.0500   0.0 -0.01 1.9 ! alkane (CT3), 4/98, yin, adm jr; Rmin/2 modified from 2.04 to 2.05
OG311    0.0       -0.1921     1.7650 ! og MeOH and EtOH 1/06 (was -0.1521 1.7682)

end

GOTO toppar_ret

label readc
read COOR card
* Ethanol X 2 coords 
*
        18  EXT
         1         1  ETOH      C1             -1.0158351002       -0.1315735419        0.0000884122  SEG2      1               0.0000000000
         2         1  ETOH      C2              0.4253069596        0.3312606962       -0.0000892567  SEG2      1               0.0000000000
         3         1  ETOH      O1              1.2760133048       -0.8055195319       -0.0007430057  SEG2      1               0.0000000000
         4         1  ETOH      H1             -1.7003384919        0.7215583767        0.0002786806  SEG2      1               0.0000000000
         5         1  ETOH      H2             -1.2226510066       -0.7498797157       -0.8800210448  SEG2      1               0.0000000000
         6         1  ETOH      H3             -1.2231385843       -0.7505296134        0.8790722841  SEG2      1               0.0000000000
         7         1  ETOH      H4              0.6360302053        0.9280324280        0.8921445769  SEG2      1               0.0000000000
         8         1  ETOH      H5              0.6362027855        0.9304404558       -0.8907775110  SEG2      1               0.0000000000
         9         1  ETOH      H6              2.1884099278       -0.4737895537        0.0000468643  SEG2      1               0.0000000000
        10         2  ETOH      C1             -1.0158351002       -0.1315735419        0.0000884122  SEG1      1               0.0000000000
        11         2  ETOH      C2              0.4253069596        0.3312606962       -0.0000892567  SEG1      1               0.0000000000
        12         2  ETOH      O1              1.2760133048       -0.8055195319       -0.0007430057  SEG1      1               0.0000000000
        13         2  ETOH      H1             -1.7003384919        0.7215583767        0.0002786806  SEG1      1               0.0000000000
        14         2  ETOH      H2             -1.2226510066       -0.7498797157       -0.8800210448  SEG1      1               0.0000000000
        15         2  ETOH      H3             -1.2231385843       -0.7505296134        0.8790722841  SEG1      1               0.0000000000
        16         2  ETOH      H4              0.6360302053        0.9280324280        0.8921445769  SEG1      1               0.0000000000
        17         2  ETOH      H5              0.6362027855        0.9304404558       -0.8907775110  SEG1      1               0.0000000000
        18         2  ETOH      H6              2.1884099278       -0.4737895537        0.0000468643  SEG1      1               0.0000000000

GOTO @return
